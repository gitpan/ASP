<HTML>
<HEAD>
<TITLE>ASP - a Module for ASP Programming</TITLE>
<LINK REV="made" HREF="mailto:">
		<link rel="stylesheet" href="../win32prk.css" type="text/css">
</HEAD>
	<BODY BGCOLOR="FFFFFF">
	<!-- beginning of leaf header-->

	<TABLE border=0  cellpadding=0 cellspacing=0 width=100%>
	<TR>
		<TD valign=middle width="100%"
		bgcolor="#cc0066"> <font face="sans-serif" size="+1"
		color="#ff99cc">&nbsp;&nbsp;&nbsp;ASP - a Module for ASP Programming</font>
		</TD>
	</TR>
	</TABLE>
	<p>&nbsp</p>
	<!-- end of leaf content-->
<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#NAME">NAME</A></LI>
	<LI><A HREF="#SYNOPSIS">SYNOPSIS</A></LI>
	<LI><A HREF="#DESCRIPTION">DESCRIPTION</A></LI>
	<LI><A HREF="#NOTES">NOTES</A></LI>
	<LI><A HREF="#INSTALLATION">INSTALLATION</A></LI>
	<LI><A HREF="#USE">USE</A></LI>
	<UL>

		<LI><A HREF="#use_ASP_qw_basic_">use ASP qw(:basic);</A></LI>
		<LI><A HREF="#use_ASP_qw_strict_">use ASP qw(:strict);</A></LI>
		<LI><A HREF="#use_ASP_qw_all_">use ASP qw(:all);</A></LI>
		<LI><A HREF="#use_ASP_">use ASP ();</A></LI>
	</UL>

	<LI><A HREF="#FUNCTION_REFERENCE">FUNCTION REFERENCE</A></LI>
	<UL>

		<LI><A HREF="#warn_LIST">warn LIST</A></LI>
		<LI><A HREF="#print_LIST">print LIST</A></LI>
		<LI><A HREF="#Print_LIST">Print LIST</A></LI>
		<LI><A HREF="#DebugPrint_LIST">DebugPrint LIST</A></LI>
		<LI><A HREF="#HTMLPrint_LIST">HTMLPrint LIST</A></LI>
		<LI><A HREF="#die_LIST">die LIST</A></LI>
		<LI><A HREF="#exit">exit</A></LI>
		<LI><A HREF="#escape_LIST">escape LIST</A></LI>
		<LI><A HREF="#unescape_LIST">unescape LIST</A></LI>
		<LI><A HREF="#escapeHTML_LIST">escapeHTML LIST</A></LI>
		<LI><A HREF="#unescapeHTML_LIST">unescapeHTML LIST</A></LI>
		<LI><A HREF="#param_EXPR_EXPR_">param EXPR [, EXPR]</A></LI>
		<LI><A HREF="#param_count_EXPR">param_count EXPR</A></LI>
		<LI><A HREF="#AddDeathHook_LIST">AddDeathHook LIST</A></LI>
		<LI><A HREF="#BinaryWrite_LIST">BinaryWrite LIST</A></LI>
		<LI><A HREF="#SetCookie_Name_Value_HASH_">SetCookie Name, Value [, HASH]</A></LI>
	</UL>

	<LI><A HREF="#AUTHOR">AUTHOR</A></LI>
	<LI><A HREF="#HISTORY">HISTORY</A></LI>
</UL>
<!-- INDEX END -->

<HR>
<H1><A NAME="NAME">NAME</A></H1>
<P>
ASP - a Module for ASP (PerlScript) Programming

</P>
<HR>
<H1><A NAME="SYNOPSIS">SYNOPSIS</A></H1>
<P>
<PRE>        use strict;
        use ASP qw(:strict);
</PRE>
</P>
<P>
<PRE>        print &quot;Testing, testing.&lt;BR&gt;&lt;BR&gt;&quot;;
        my $item = param('item');
</PRE>
</P>
<P>
<PRE>        if($item eq 'Select one...') {
            die &quot;Please select a value from the list.&quot;;
        }
</PRE>
</P>
<P>
<PRE>        print &quot;You selected $item.&quot;;
        exit;
</PRE>
</P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION</A></H1>
<P>
This module is based on Matt Sergeant's excellent Win32::ASP module, which
can be found at
&lt;<EM>http://www.fastnetltd.ndirect.co.uk/Perl</EM>&gt;. After using Mr. Sergeant's module, I took on the task of customizing and
optimizing it for my own purposes. Feel free to use it if you find it
useful.

</P>
<HR>
<H1><A NAME="NOTES">NOTES</A></H1>
<P>
Both of the <CODE>print()</CODE> and <CODE>warn()</CODE> standard perl
funcs are overloaded to output to the browser. <CODE>print()</CODE> is also
available via the $ASP::ASPOUT-&gt;print() method call.

</P>
<P>
$Request-&gt;ServerVariables are stuffed in <CODE>%ENV</CODE> to more
closely resemble CGI.pm

</P>
<P>
ASP.pm now exports the <CODE>$ScriptingNamespace</CODE> symbol. This symbol
allows PerlScript to call subs/functions written in another script
language. For example:

</P>
<P>
<PRE>    &lt;%@ language=PerlScript %&gt;
    &lt;%
        use ASP qw(:strict);
        print $ScriptingNamespace-&gt;SomeSub(&quot;arg1&quot;);
    %&gt;
    &lt;SCRIPT language=VBScript runat=server&gt;
    Function SomeSub (str)
        SomeSub = SomethingThatReturnsSomething()
    End Function
    &lt;/SCRIPT&gt;
</PRE>
</P>
<HR>
<H1><A NAME="INSTALLATION">INSTALLATION</A></H1>
<P>
This module can be installed via my PPM repository at

</P>
<P>
<PRE>   <A HREF="http://dichosoft.com/perl">http://dichosoft.com/perl</A>
</PRE>
</P>
<HR>
<H1><A NAME="USE">USE</A></H1>
<HR>
<H2><A NAME="use_ASP_qw_basic_">use ASP qw(:basic);</A></H2>
<P>
Exports basic subs: Print, Warn, die, exit, param, param_count.

</P>
<HR>
<H2><A NAME="use_ASP_qw_strict_">use ASP qw(:strict);</A></H2>
<P>
Allows the use of the ASP objects under <CODE>use strict;</CODE>.

</P>
<P>
NOTE: This is not the only way to accomplish this, but I think it's the
cleanest, most convenient way.

</P>
<HR>
<H2><A NAME="use_ASP_qw_all_">use ASP qw(:all);</A></H2>
<P>
Same as <CODE>use ASP;</CODE>. Exports all subs except those marked 'not exported'.

</P>
<HR>
<H2><A NAME="use_ASP_">use ASP ();</A></H2>
<P>
Overloads <CODE>print()</CODE> and <CODE>warn()</CODE> and provides the
$ASP::ASPOUT object.

</P>
<HR>
<H1><A NAME="FUNCTION_REFERENCE">FUNCTION REFERENCE</A></H1>
<HR>
<H2><A NAME="warn_LIST">warn LIST</A></H2>
<P>
<CODE>warn</CODE> (or more specifically, the __WARN__ signal) has been re-routed to output to
the browser.

</P>
<P>
FYI: When implemented, this tweak led to the removal of the prototypes Matt
placed on his subs.

</P>
<HR>
<H2><A NAME="print_LIST">print LIST</A></H2>
<P>
<CODE>print</CODE> is overloaded to write to the browser by default. The inherent behavior of
print has not been altered and you can still use an alternate filehandle as
you normally would. This allows you to use print just as you would in CGI
scripts. The following statement would need no modification between CGI and
ASP PerlScript:

</P>
<P>
<PRE>    print param('URL'), &quot; was requested by &quot;, $ENV{REMOTE_HOST}, &quot;\n&quot;;
</PRE>
</P>
<HR>
<H2><A NAME="Print_LIST">Print LIST</A></H2>
<P>
Prints a string or comma separated list of strings to the browser. Use as
if you were using <CODE>print</CODE> in a CGI application. Print gets around ASP's limitations of 128k in a
single $Response-&gt;Write() call.

</P>
<P>
NB: <CODE>print</CODE> calls Print, so you could use either, but print more closely resembles
perl.

</P>
<HR>
<H2><A NAME="DebugPrint_LIST">DebugPrint LIST</A></H2>
<P>
Output is displayed between HTML comments so the output doesn't interfere
with page aesthetics.

</P>
<HR>
<H2><A NAME="HTMLPrint_LIST">HTMLPrint LIST</A></H2>
<P>
The same as <CODE>Print</CODE> except the output is HTML-encoded so that any HTML tags appear as sent,
i.e. &lt; becomes &amp;lt;, &gt; becomes &amp;gt; etc.

</P>
<HR>
<H2><A NAME="die_LIST">die LIST</A></H2>
<P>
Prints the contents of LIST to the browser and then exits. die
automatically calls $Response-&gt;End for you, it also executes any cleanup
code you have added with <CODE>AddDeathHook</CODE>.

</P>
<HR>
<H2><A NAME="exit">exit</A></H2>
<P>
Exits the current script. $Response-&gt;End is called automatically for
you. Any cleanup code added with <CODE>AddDeathHook</CODE> is also called.

</P>
<HR>
<H2><A NAME="escape_LIST">escape LIST</A></H2>
<P>
Escapes (URL-encodes) a list. Uses ASP object method
$Server-&gt;URLEncode().

</P>
<HR>
<H2><A NAME="unescape_LIST">unescape LIST</A></H2>
<P>
Unescapes a URL-encoded list. Algorithms ripped from CGI.pm method of the
same name.

</P>
<HR>
<H2><A NAME="escapeHTML_LIST">escapeHTML LIST</A></H2>
<P>
Escapes a list of HTML. Uses ASP object method $Server-&gt;HTMLEncode().

</P>
<P>
If passed an array reference, escapeHTML will return a reference to the
escaped array.

</P>
<HR>
<H2><A NAME="unescapeHTML_LIST">unescapeHTML LIST</A></H2>
<P>
Unescapes an HTML-encoded list.

</P>
<P>
If passed an array reference, unescapeHTML will return a reference to the
un-escaped array.

</P>
<HR>
<H2><A NAME="param_EXPR_EXPR_">param EXPR [, EXPR]</A></H2>
<P>
Simplifies parameter access and makes switch from GET to POST transparent.

</P>
<P>
Given the following querystring:

</P>
<P>
<PRE>        myscript.asp?x=a&amp;x=b&amp;y=c
</PRE>
</P>
<P>
<PRE>    param()      returns ('x', 'y')
    param('y')   returns 'c'
    param('x')   returns ('a', 'b')
    param('x',1) returns 'a'
    param('x',2) returns 'b'
</PRE>
</P>
<H2><A NAME="param_count_EXPR">param_count EXPR</A></H2>
<P>
Returns the number of times EXPR appears in the request (Form or
QueryString).

</P>
<P>
For example, if URL is

</P>
<P>
<PRE>        myscript.asp?x=a&amp;x=b&amp;y=c
</PRE>
</P>
<P>
then

</P>
<P>
<PRE>        param_count('x');
</PRE>
</P>
<P>
returns 2.

</P>
<H2><A NAME="AddDeathHook_LIST">AddDeathHook LIST</A></H2>
<P>
Allows cleanup code to be executed when you <CODE>die</CODE> or <CODE>exit</CODE>. Useful for closing database connections in the event of a fatal error.

</P>
<P>
<PRE>        &lt;%
        my $conn = Win32::OLE-new('ADODB.Connection');
        $conn-&gt;Open(&quot;MyDSN&quot;);
        $conn-&gt;BeginTrans();
        ASP::AddDeathHook( sub { $Conn-&gt;Close if $Conn; } );
        %&gt;
</PRE>
</P>
<P>
Death hooks should be executed on a graceful exit of the script too but
this hasn't been confirmed. If anyone has any luck, let me know.

</P>
<P>
AddDeathHook is not exported.

</P>
<H2><A NAME="BinaryWrite_LIST">BinaryWrite LIST</A></H2>
<P>
Performs the same function as $Response-&gt;BinaryWrite() but gets around
Perl's lack of unicode support, and the null padding it uses to get around
this. Example:

</P>
<P>
<PRE>        ASP::BinaryWrite($val);
</PRE>
</P>
<P>
BinaryWrite is not exported.

</P>
<H2><A NAME="SetCookie_Name_Value_HASH_">SetCookie Name, Value [, HASH]</A></H2>
<P>
Sets the cookie Name with the value Value. HASH is optional, and contains
any of the following optional parameters:

</P>
<P>
<PRE>    -expires =&gt; CGI.pm style expires value
    -domain =&gt; domain that the cookie is returned to; eg, &quot;.domain.com&quot;
    -path =&gt; a path that the cookie is returned to.
    -secure =&gt; cookie only returned under SSL if true.
</PRE>
</P>
<P>
If Value is a hash ref, then it creates a cookie dictionary. (see either
the ASP docs, or my Introduction to PerlScript for more info on Cookie
Dictionaries).

</P>
<P>
Example:

</P>
<P>
<PRE>        ASP::SetCookie(&quot;Options&quot;, { bg=&gt;'white', text=&gt;'black' }, (
            -expires =&gt; &quot;+3h&quot;,
            -domain =&gt; &quot;.dichosoft.com&quot;,
            -path =&gt; &quot;/perl&quot;,
            -secure =&gt; 0 )
            );
</PRE>
</P>
<P>
SetCookie is not exported.

</P>
<H1><A NAME="AUTHOR">AUTHOR</A></H1>
<P>
Tim Hammerquist &lt;<EM>tim@dichosoft.com</EM>&gt;



</P>
<H1><A NAME="HISTORY">HISTORY</A></H1>
<DL>
<DT><STRONG><A NAME="item_Version">Version 1.00</A></STRONG><DD>
<P>
The <CODE>escapeHTML()</CODE> and <CODE>unescapeHTML()</CODE> functions now
accept array refs as well as lists, as Win32::ASP::HTMLEncode() was
supposed to. Thanks to Matt Sergeant for the fix.

</P>
<DT><STRONG>Version 0.97</STRONG><DD>
<P>
Optimized and debugged.

</P>
<DT><STRONG>Version 0.77</STRONG><DD>
<P>
Overloaded <CODE>warn()</CODE> and subsequently removed prototypes.

</P>
<P>
Exported <CODE>$ScriptingNamespace</CODE> object.

</P>
<P>
Added methods <CODE>escape(),</CODE> <CODE>unescape(),</CODE>
<CODE>escapeHTML(),</CODE> <CODE>unescapeHTML().</CODE> Thanks to Bill Odom
for pointing these out!

</P>
<P>
Re-implemented SetCookie and BinaryWrite functions.

</P>
<DT><STRONG>Version 0.11</STRONG><DD>
<P>
Optimized and debugged.

</P>

</DL>
		<!-- beginning of leaf footer-->
		<p>&nbsp;</p>
		<TABLE border=0  cellpadding=0 cellspacing=0 width=100%>
		<TR>
			<TD valign=middle
				bgcolor="#cc0066"> <font face="sans-serif" size="+1"
				color="#ff99cc">&nbsp;&nbsp;&nbsp;ASP - a Module for ASP Programming</font>
			</TD>
		</TR>
		</TABLE>
		<!-- end of leaf footer-->
		</BODY>
		</HTML>
